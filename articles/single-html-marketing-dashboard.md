---
title: "3,871行の単一HTMLでインタラクティブなマーケティング戦略ダッシュボードを構築した話"
emoji: "📊"
type: "tech"
topics: ["HTML", "JavaScript", "Mermaid", "マーケティング", "アクセシビリティ"]
published: false
publication_name: "correlate_dev"
---

## はじめに

マーケティング戦略のドキュメントは、作った瞬間から陳腐化が始まります。Notionやスプレッドシートに分散した情報は、気づけば誰も更新しなくなり、「最新版はどれ？」という確認コストが積み上がっていきます。

今回は、ISVD（一般社団法人。デジタルマーケティング支援を目的とした団体）のマーケティング戦略を可視化するために、 **外部依存ゼロの単一HTMLファイル** でインタラクティブなダッシュボードを構築しました。結果として18セクション・3,871行（コメント・空行含む、ミニファイ前）のファイルが完成し、フロー図・ガントチャート・状態遷移図・永続チェックリストをすべて1ファイルに収めることができました。

この記事では、HTML/CSS/JavaScriptの基礎知識があるマーケター・ディレクターを主な読者として想定しながら、設計思想・実装上の工夫・イテレーション過程を具体的にご紹介します。

---

## なぜ「単一HTML」を選んだのか

### 依存ライブラリの自動更新が発生しない構成という選択

マーケティング戦略ドキュメントに求めた要件は、次の3点でした。

1. **環境依存なし** ── Node.js・Python・サーバー不要で、ファイルをダブルクリックするだけで動作すること
2. **配布が一撃** ── メールやSlackに1ファイル添付するだけで共有が完結すること
3. **運用負荷の最小化** ── ライブラリのバージョン管理や依存関係の自動更新作業が発生しないこと（ただし、Mermaid.jsをインライン化しているため、セキュリティパッチの適用は手動対応が必要です）

SaaSダッシュボードツールは機能が豊富な反面、月額コスト・アカウント管理・ネットワーク依存という運用負荷が伴います。たとえばNotionやNotion AI（月額$10〜）、Looker Studio（無料だがGoogleアカウント依存）といったツールは、社内向けの戦略ドキュメント管理には過剰なコストになりえます。

一方、単純なMarkdownやPDFでは、「図を埋め込む」「チェックリストの状態を保持する」といったインタラクティブ性を実現できません。

この2つのギャップを埋める解として、 **外部CDNを一切使わない自己完結型HTML** という選択に至りました。

### 「依存ゼロ」の意味

ここで言う「依存ゼロ」とは、ファイルを開くブラウザ以外に何も必要としない状態を指します。Mermaid.jsはCDNから読み込むのではなく、スクリプトをHTMLにインライン展開しています。フォントもシステムフォントスタックのみを使用し、画像も埋め込みSVGで対応しました。

#### Mermaid.jsのインライン化手順

Mermaid.jsのインライン化は以下の手順で実施しました。

1. **使用バージョンの取得** ：Mermaid.js公式リポジトリのリリースページから`mermaid.min.js`（v10.6.1）をダウンロードします。CDNから取得する場合は`https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js`を参照してください。

2. **HTMLへの埋め込み** ：ダウンロードした`mermaid.min.js`の内容をそのまま`<script>`タグ内にペーストします。

```html
<script>
  /* mermaid.min.js v10.6.1 の内容をここに貼り付け（約300KB） */
  !function(e,t){ /* ... */ }();
</script>
```

3. **初期化処理の記述** ：インライン化したスクリプトの後、`DOMContentLoaded`イベント内で`mermaid.initialize()`を呼び出します。

```html
<script>
  document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({ startOnLoad: true, theme: 'dark' });
  });
</script>
```

この手順により、外部ネットワーク接続なしでMermaid.jsのダイアグラムが描画されます。なお、インライン化によりMermaid.jsのバージョンは固定となるため、セキュリティアップデートが必要な場合は手動でファイルを差し替える必要があります。

---

## 全体構成：18セクション・3,871行の設計

### セクション構成の概要

ダッシュボードは以下の18セクションで構成されています。大きく「戦略レイヤー」「実行レイヤー」「計測レイヤー」の3グループに分類できます。

| グループ | セクション例 | 主な可視化手法 |
|---|---|---|
| 戦略レイヤー | ミッション・ビジョン、ターゲット定義、競合ポジショニング | テキスト＋フロー図 |
| 実行レイヤー | コンテンツカレンダー、施策チェックリスト、SNS運用フロー | ガントチャート・状態遷移図・チェックリスト |
| 計測レイヤー | KPI定義、レビューサイクル、改善ループ | フロー図・テーブル |

各セクションは独立したHTMLブロックとして設計されており、目次からアンカーリンクで直接ジャンプできます。

### ナビゲーション設計

ページ上部には固定ヘッダーとして目次ナビゲーションを配置しました。CSS Gridで2カラムレイアウトを構成し、左カラムに目次、右カラムにコンテンツ本体を表示する構造です。スクロール位置に応じて現在地セクションをハイライトする処理は、`IntersectionObserver`で実装しています。

---

## Mermaid.jsの実践的な活用パターン

### フロー図：施策の意思決定ツリー

マーケティング施策の優先度判断フローを、Mermaid.jsの`flowchart TD`構文で表現しました。

```html
<div class="mermaid">
flowchart TD
    A[施策アイデア] --> B{KPIとの整合性}
    B -->|高| C{リソース確認}
    B -->|低| D[バックログへ]
    C -->|確保可能| E[四半期計画に組込]
    C -->|不足| F[優先度再評価]
</div>
```

Mermaid.jsをインラインで動作させるため、`mermaid.initialize()`の呼び出しをDOMContentLoadedイベント内に記述し、レンダリングタイミングを制御しています。

### ガントチャート：コンテンツカレンダーの可視化

四半期ごとのコンテンツ施策スケジュールをガントチャートで表現しました。

```html
<div class="mermaid">
gantt
    title Q1コンテンツカレンダー
    dateFormat YYYY-MM-DD
    section ブログ
    記事A執筆    :2026-01-05, 7d
    記事A公開    :2026-01-12, 1d
    section SNS
    キャンペーン企画 :2026-01-10, 5d
</div>
```

ガントチャートは月次・四半期・年次の3粒度でセクションを用意し、閲覧者が必要な粒度を選んで確認できるように設計しました。

### 状態遷移図：リードナーチャリングフロー

リードの状態変化（初回接触→関心→検討→商談→成約）を`stateDiagram-v2`で表現しました。状態遷移図はMermaid.jsの中でも比較的知名度が低いダイアグラムタイプですが、ナーチャリングフローの全体像を把握するのに適しています。

```html
<div class="mermaid">
stateDiagram-v2
    [*] --> 初回接触
    初回接触 --> 関心 : コンテンツ閲覧
    関心 --> 検討 : 資料DL
    検討 --> 商談 : お問い合わせ
    商談 --> 成約 : 契約締結
    商談 --> 検討 : 再検討
</div>
```

---

## localStorageによる永続チェックリスト

### 実装の動機

施策チェックリストは「確認したら状態を保持しておきたい」という実務的なニーズから生まれた機能です。単純なHTMLチェックボックスはページリロードで状態がリセットされますが、localStorageを使うことでブラウザを閉じても状態が維持されます。

### 実装の概要

チェックボックスの状態をlocalStorageに保存・復元する処理は、以下の方針で実装しました。

- 各チェックボックスに一意の`data-key`属性を付与
- `change`イベントで`localStorage.setItem(key, checked)`を実行
- ページロード時に`localStorage.getItem(key)`で状態を復元
- 「すべてリセット」ボタンで該当キーを一括削除

```javascript
document.querySelectorAll('input[data-key]').forEach(cb => {
    const key = cb.dataset.key;
    cb.checked = localStorage.getItem(key) === 'true';
    cb.addEventListener('change', () => {
        localStorage.setItem(key, cb.checked);
    });
});
```

コア処理は上記の7行で、初期化処理・リセット機能を含めると約30行の実装です。シンプルながら、ドキュメントの実用性を大きく高める機能となりました。

---

## WCAG 2.1 AA準拠を目標としたアクセシビリティ対応

### 重点対応した3つの要件

ダッシュボードはWCAG 2.1 AAレベルへの準拠を目標として設計しました。WCAG 2.1 AAには「1.3.1 情報と関係性」「2.4.3 フォーカス順序」「4.1.2 名前・役割・値」など多数の達成基準が存在しますが、本実装では特に以下の3点を重点的に対応しました。網羅的な検証を行う場合はaxeやWAVEなどの専用ツールの活用を推奨します。

**① コントラスト比4.5:1以上**

テキストと背景色の組み合わせをすべてChrome DevToolsのアクセシビリティパネルで検証しました。ダークテーマのデフォルト配色として、背景色`#1a1a2e`に対してテキスト色`#e8e8f0`を採用し、コントラスト比7.2:1を確保しています。

**② 最小フォントサイズ11px**

本文テキストは14px、補足テキストは11pxを最小値として設定しました。CSS変数でフォントサイズを一元管理し、変更が容易な構造にしています。

**③ キーボードナビゲーション対応**

すべてのインタラクティブ要素（チェックボックス・ナビゲーションリンク・リセットボタン）にTabキーでアクセスできることを確認しました。フォーカス時のアウトライン表示を`outline: 2px solid #4a9eff`で統一し、視認性を確保しています。

### ダークテーマの設計

CSS変数を使ったテーマ設計により、ダークテーマをデフォルトとしながらも、将来のライトテーマ追加を容易にしています。

```css
:root {
    --bg-primary: #1a1a2e;       /* ページ全体の背景色 */
    --bg-secondary: #16213e;     /* カード背景。--bg-primaryとの差分で奥行きを表現 */
    --text-primary: #e8e8f0;     /* 本文テキスト。背景との比7.2:1を確保 */
    --text-secondary: #a0a0b8;   /* 補足テキスト・ラベル等に使用 */
    --accent: #4a9eff;           /* フォーカスアウトライン・強調表示に使用 */
}
```

---

## v1からv6へ：6回のイテレーション

### イテレーションの全体像

完成版（v6）に至るまで、6回のバージョンアップとDAレビュー3回を経ました。各イテレーションで解決した課題を以下に整理します。

| バージョン | 主な変更内容 |
|---|---|
| v1 | 基本構造の確立。セクション骨格とナビゲーション実装 |
| v2 | Mermaid.jsのインライン化。CDN依存を排除し、`mermaid.min.js` v10.6.1をscriptタグ内に展開 |
| v3 | localStorageチェックリスト追加。ページリロード後も状態が保持されるように |
| v4 | アクセシビリティ対応。コントラスト比・キーボードナビゲーション・フォントサイズ調整 |
| v5 | DAレビュー対応。ナビゲーション改善・セクション追加・情報密度の調整 |
| v6 | 最終調整。IntersectionObserver実装・CSS変数整理・コメント追加 |
