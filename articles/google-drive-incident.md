---
title: "Google Driveã§é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’åŒæœŸã—ãŸã‚‰167GBæ›¸ãè¾¼ã¾ã‚ŒãŸè©±"
emoji: "ğŸ’¥"
type: "tech"
topics: ["GoogleDrive", "Mac", "é–‹ç™ºç’°å¢ƒ", "å¤±æ•—è«‡"]
published: true
publication_name: "correlate_dev"
---

## ã¯ã˜ã‚ã«

Mac mini M4 Proã‚’è²·ã„ã¾ã—ãŸã€‚é–‹ç™ºç’°å¢ƒã‚’ç§»è¡Œã™ã‚‹ã«ã‚ãŸã‚Šã€MacBook Proã®`~/dev/`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãã®ã¾ã¾æ–°ãƒã‚·ãƒ³ã«ã‚³ãƒ”ãƒ¼ã—ãŸã„ã€‚Google Drive for Desktopï¼ˆæ—§: Drive File Streamï¼‰ãŒå‹•ã„ã¦ã„ã‚‹ã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰çµŒç”±ã§åŒæœŸã™ã‚Œã°æ¥½ã ã‚ã†â€•â€•ãã†è€ƒãˆãŸçµæœãŒã“ã¡ã‚‰ã€‚

:::message alert
fileproviderdãƒ—ãƒ­ã‚»ã‚¹ãŒ167GBã®ãƒ‡ã‚£ã‚¹ã‚¯æ›¸ãè¾¼ã¿ã‚’ç™ºç”Ÿã€‚é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã®å®Ÿã‚µã‚¤ã‚ºã¯ã‚ãšã‹10.3GiBã€‚ç´„15å€ã®æ›¸ãè¾¼ã¿ãŒèµ°ã‚Šã€ãƒã‚·ãƒ³ã¯å®Œå…¨ã«ãƒ•ãƒªãƒ¼ã‚ºçŠ¶æ…‹ã«é™¥ã‚Šã¾ã—ãŸã€‚
:::

ã€ŒGoogle Driveã§é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’åŒæœŸã—ã¦ã¯ã„ã‘ãªã„ã€â€•â€•ã“ã‚Œã€çŸ¥ã£ã¦ã„ã‚‹äººã«ã¯å½“ãŸã‚Šå‰ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã§ã‚‚ç§ã¯ã‚„ã£ã¦ã—ã¾ã£ãŸã€‚åŒã˜è½ã‚’è¸ã‚€äººã‚’ä¸€äººã§ã‚‚æ¸›ã‚‰ã™ãŸã‚ã«ã€ä½•ãŒèµ·ããŸã®ã‹ã€ãªãœèµ·ããŸã®ã‹ã€ãã—ã¦ã©ã†å¯¾å‡¦ã—ãŸã®ã‹ã‚’è¨˜éŒ²ã—ã¦ãŠãã¾ã™ã€‚

## ä½•ãŒèµ·ããŸã‹

### çŠ¶æ³

æ–°ã—ã„Mac mini M4 Proï¼ˆ64GB RAMï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã€‚MacBook Proã‹ã‚‰é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’ç§»è¡Œã—ã‚ˆã†ã¨ã—ã¦ã€Google Drive for DesktopçµŒç”±ã§`cp -R`ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚

ã€Œã‚¯ãƒ©ã‚¦ãƒ‰ã«ã‚ã‚‹ã‚“ã ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã§ã—ã‚‡ã€ã¨ã„ã†è»½ã„æ°—æŒã¡ã€‚é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã¯ã“ã‚“ãªæ§‹æˆã€‚

| é …ç›® | æ•°å€¤ |
|------|------|
| ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•° | 87,716 |
| ç·ã‚µã‚¤ã‚º | 10.3GiB |
| node_modulesãƒ•ã‚©ãƒ«ãƒ€æ•° | è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†ï¼ˆ20ä»¥ä¸Šï¼‰ |
| .gitãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ•° | 30ä»¥ä¸Š |
| vendorï¼ˆPHPï¼‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | 10ä»¥ä¸Š |

### ç™ºç”Ÿã—ãŸç—‡çŠ¶

`cp -R`å®Ÿè¡Œç›´å¾Œã‹ã‚‰ç•°å¤‰ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚

1. å¤§é‡ã®ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼: `cp`ã‚³ãƒãƒ³ãƒ‰ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ã‚’é€£ç™º
2. ãƒ‡ã‚£ã‚¹ã‚¯I/Oã®é£½å’Œ: Activity Monitorã§`fileproviderd`ã®ãƒ‡ã‚£ã‚¹ã‚¯æ›¸ãè¾¼ã¿ãŒç•°å¸¸ãªé€Ÿåº¦ã§å¢—åŠ 
3. ãƒã‚·ãƒ³ã®è‘—ã—ã„é…å»¶: UIæ“ä½œã™ã‚‰ã¾ã¾ãªã‚‰ãªã„çŠ¶æ…‹ã«
4. æœ€çµ‚çš„ãªæ›¸ãè¾¼ã¿é‡: 167GBï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ã®ç´„15å€ï¼‰

![fileproviderdã®æ›¸ãè¾¼ã¿é‡æ¯”è¼ƒ](/images/google-drive-incident/write-comparison.png)
*å®Ÿãƒ‡ãƒ¼ã‚¿10.3GiBã«å¯¾ã—ã¦fileproviderdã¯167GBã‚’æ›¸ãè¾¼ã‚“ã ï¼ˆç´„15å€ï¼‰*

167GBã¨ã„ã†æ•°å­—ã€ãƒ”ãƒ³ã¨ã“ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚SSDã«ã¯æ›¸ãè¾¼ã¿å¯¿å‘½ï¼ˆTBW: Total Bytes Writtenï¼‰ãŒã‚ã‚Šã€ä¸€èˆ¬çš„ãªã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼å‘ã‘1TB SSDã§600TBç¨‹åº¦ã€‚167GBã®ç„¡é§„ãªæ›¸ãè¾¼ã¿ã‚’ç¹°ã‚Šè¿”ã›ã°ã€SSDã®å¯¿å‘½ã‚’ç¢ºå®Ÿã«ç¸®ã‚ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ãŸã£ãŸ1å›ã®åŒæœŸãƒŸã‚¹ã§ã“ã‚Œã ã‘ã®æ›¸ãè¾¼ã¿ãŒèµ°ã‚‹ã®ã¯ã€åœ°å‘³ã«æ€–ã„è©±ã§ã™ã‚ˆã­ã€‚

## ãªãœèµ·ããŸã‹

### fileproviderdã¨ã¯ä½•ã‹

`fileproviderd`ã¯ã€macOSã«æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚iCloud Driveã€Google Driveã€OneDriveã€Dropboxãªã©ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã¨macOSã®Finderã‚’çµ±åˆç®¡ç†ã™ã‚‹å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã‚‹ã€‚

```mermaid
graph LR
    A[Finder] --- B[fileproviderd]
    B --- C[iCloud Drive]
    B --- D[Google Drive]
    B --- E[OneDrive]
    B --- F[Dropbox]
    style B fill:#ff6b6b,color:#fff
```

macOS Venturaä»¥é™ã€Appleã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã«å¯¾ã—ã¦ã€ç‹¬è‡ªã®ã‚«ãƒ¼ãƒãƒ«ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã§ã¯ãªãFile Provider APIï¼ˆ`NSFileProviderExtension`ï¼‰ã®ä½¿ç”¨ã‚’ç¾©å‹™åŒ–ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Google Driveã‚‚Appleã®File Providerãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é€šã˜ã¦å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã£ãŸ[^1]ã€‚

[^1]: TidBITSã€ŒApple's File Provider Forces Mac Cloud Storage Changesã€(2023) https://tidbits.com/2023/03/10/apples-file-provider-forces-mac-cloud-storage-changes/

### é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ãŒã€Œåœ°é›·ã€ã«ãªã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

å•é¡Œã®æ ¸å¿ƒã¯ã€é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã«å«ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰¹æ€§ã¨fileproviderdã®å‡¦ç†æ–¹å¼ã®ç›¸æ€§ã«ã‚ã‚Šã¾ã™ã€‚

:::details é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã«å«ã¾ã‚Œã‚‹ã€Œå±é™ºãªã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | ç‰¹å¾´ | å…¸å‹çš„ãªãƒ•ã‚¡ã‚¤ãƒ«æ•° |
|-------------|------|-----------------|
| `node_modules/` | æ•°åƒã€œæ•°ä¸‡ã®å°ãƒ•ã‚¡ã‚¤ãƒ«ã€æ·±ã„éšå±¤æ§‹é€  | 10,000ã€œ50,000+ |
| `.git/objects/` | å¤§é‡ã®ãƒãƒƒã‚·ãƒ¥åã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | 1,000ã€œ10,000+ |
| `vendor/` (PHP) | Composerã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | 5,000ã€œ20,000+ |
| `.next/` / `dist/` | ãƒ“ãƒ«ãƒ‰æˆæœç‰© | æ•°ç™¾ã€œæ•°åƒ |
| `__pycache__/` | Pythonãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ | æ•°åã€œæ•°ç™¾ |
:::

ä»¥ä¸‹ã¯fileproviderdã®æŒ™å‹•ã‹ã‚‰æ¨å®šã•ã‚Œã‚‹å‡¦ç†ãƒ•ãƒ­ãƒ¼ã€‚Appleã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯å†…éƒ¨å®Ÿè£…ã®è©³ç´°ã¯å…¬é–‹ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€File Provider APIã®ä»•æ§˜ã¨Activity Monitorã®è¦³æ¸¬çµæœã‹ã‚‰ã€ãŠãŠã‚ˆãã“ã®ã‚ˆã†ãªæµã‚Œã§å‡¦ç†ãŒèµ°ã£ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

```mermaid
graph TD
    A[æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡º] --> B[ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç™»éŒ²]
    B --> C[ãƒãƒƒã‚·ãƒ¥è¨ˆç®—]
    C --> D[åŒæœŸã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ]
    D --> E[ã‚¯ãƒ©ã‚¦ãƒ‰APIã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¦æ±‚]
    E --> F{æˆåŠŸ?}
    F -->|Yes| G[åŒæœŸçŠ¶æ…‹ã‚’æ›´æ–°]
    F -->|No| H[ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã¸]
    H --> D
    style H fill:#ff9999
```

87,716ãƒ•ã‚¡ã‚¤ãƒ«ã®ãã‚Œãã‚Œã«å¯¾ã—ã¦ã“ã®å‡¦ç†ãŒèµ°ã‚‹ã€‚ã—ã‹ã‚‚node_modulesã«ã¯æ·±ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆ`node_modules/a/node_modules/b/node_modules/c/...`ï¼‰ãŒå«ã¾ã‚Œã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã ã‘ã§ã‚‚è†¨å¤§ãªé‡ã«ãªã‚Šã¾ã™ã€‚

ã•ã‚‰ã«å„ä»‹ãªã®ãŒãƒªãƒˆãƒ©ã‚¤ã®é€£é–ã€‚I/OãŒé£½å’Œã™ã‚‹ã¨å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸå‡¦ç†ã¯ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã«å…¥ã‚‹ã€‚ãƒªãƒˆãƒ©ã‚¤ãŒã•ã‚‰ã«I/Oã‚’åœ§è¿«ã—ã€æ–°ãŸãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç”Ÿã‚€ã€‚ã“ã‚ŒãŒ167GBã¨ã„ã†ç•°å¸¸ãªæ›¸ãè¾¼ã¿é‡ã®æ­£ä½“ã§ã—ã‚‡ã†ã€‚

:::message
Google Driveã‚„Dropboxã«ã¯ã€`.gitignore`ã®ã‚ˆã†ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚åŒæœŸå¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯åŸå‰‡ã™ã¹ã¦åŒæœŸã•ã‚Œã‚‹ã€‚node_modulesã‚’ã€Œã‚ã¨ã‹ã‚‰é™¤å¤–ã€ã™ã‚‹ã“ã¨ã¯ã§ãã¦ã‚‚ã€åŒæœŸé–‹å§‹æ™‚ç‚¹ã§å‡¦ç†ãŒèµ°ã£ã¦ã—ã¾ã†ã®ãŒå•é¡Œã§ã™ã€‚
:::

## æ­£ã—ã„é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã®åŒæœŸæ–¹æ³•

### æ–¹æ³•1: rsyncï¼ˆå³åŠ¹æ€§ãŒé«˜ã„ï¼‰

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã€‚macOSã«æ¨™æº–æ­è¼‰ã•ã‚Œã¦ãŠã‚Šã€è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ã§ã™ã€‚

```bash
rsync -avz --progress \
  --exclude='node_modules' \
  --exclude='.git' \
  --exclude='vendor' \
  --exclude='.DS_Store' \
  --exclude='*.log' \
  --exclude='.env' \
  --exclude='.ddev' \
  ~/dev/ user@remote-mac:~/dev/
```

ä»Šå›ã®ç§»è¡Œã§ã‚‚ã€`~/dev/`å…¨ä½“ã‚’rsyncã§ç§»è¡Œã—ãŸã¨ã“ã‚ã€23GBã®è»¢é€ã§å•é¡Œãªãå®Œäº†ã—ã¾ã—ãŸã€‚Google Driveã§167GBã®ç„¡é§„ãªæ›¸ãè¾¼ã¿ã‚’ç™ºç”Ÿã•ã›ã¦ãƒ•ãƒªãƒ¼ã‚ºã—ãŸå¾Œã«ã€rsyncãªã‚‰æ•°åˆ†ã§çµ‚ã‚ã‚‹ã€‚ãªã‚“ã¨ã‚‚çš®è‚‰ãªçµæœã¨ã„ã†ã‚ã‘ã§ã™ã€‚

### æ–¹æ³•2: Syncthingï¼ˆç¶™ç¶šçš„ãªåŒæœŸã«æœ€é©ï¼‰

2å°ä»¥ä¸Šã®Macã‚’æ—¥å¸¸çš„ã«ä½¿ã„åˆ†ã‘ã‚‹å ´åˆã€SyncthingãŒæœ€é©è§£ã§ã—ã‚‡ã†ã€‚P2Pæ–¹å¼ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹åŒæœŸãƒ„ãƒ¼ãƒ«ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ãªã‚‰é«˜é€Ÿã«åŒæ–¹å‘åŒæœŸãŒå¯èƒ½ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’çµŒç”±ã—ãªã„ã®ã§ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é¢ã§ã‚‚å®‰å¿ƒã§ã™ã€‚

å®Ÿéš›ã«`~/dev/`å…¨ä½“ã‚’Syncthingã§åŒæœŸã—ãŸçµæœãŒã“ã¡ã‚‰ã€‚node_modulesã‚„vendorã¯é™¤å¤–è¨­å®šã§åŒæœŸå¯¾è±¡å¤–ã«ã—ã¤ã¤ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€å…¨ä½“ã‚’åŒæœŸã—ã¦ã„ã¾ã™ã€‚

| é …ç›® | çµæœ |
|------|------|
| åŒæœŸå¯¾è±¡ | ~/dev/ å…¨ä½“ï¼ˆObsidianå«ã‚€ï¼‰ |
| åŒæœŸãƒ•ã‚¡ã‚¤ãƒ«æ•° | 87,716 |
| åŒæœŸã‚µã‚¤ã‚º | 10.3GiB |
| é™¤å¤–è¨­å®š | .git, node_modules, vendor, .DS_Store, *.log, .env, .ddev |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† | 30æ—¥é–“ä¿æŒ |
| æ‰€è¦æ™‚é–“ | åˆå›åŒæœŸå¾Œã¯å·®åˆ†ã®ã¿ |

`.stignore`ãƒ•ã‚¡ã‚¤ãƒ«ã§é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨­å®šã§ãã‚‹ã®ãŒå¤§ããªå¼·ã¿ã€‚

```
// .stignore
.git
node_modules
vendor
.DS_Store
*.log
.env
.ddev
```

### æ–¹æ³•3: Gitï¼ˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç®¡ç†ã®ç‹é“ï¼‰

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯Git + GitHub/GitLabã§ç®¡ç†ã™ã‚‹ã®ãŒå¤§å‰æã€‚ãŸã ã—ã€ã“ã‚Œã¯ã€ŒåŒæœŸã€ã§ã¯ãªãã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã€ãªã®ã§ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå›ºæœ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¯¾è±¡å¤–ã«ãªã‚‹ã€‚

![åŒæœŸæ–¹æ³•åˆ¥ã®ãƒ‡ã‚£ã‚¹ã‚¯æ›¸ãè¾¼ã¿é‡æ¯”è¼ƒ](/images/google-drive-incident/sync-method-comparison.png)
*Google DriveçµŒç”±ã¯167GBæ›¸ãè¾¼ã¿+ãƒ•ãƒªãƒ¼ã‚ºã€‚rsyncãªã‚‰23GBã§æ•°åˆ†ã€Syncthingãªã‚‰10.3GiBã§å·®åˆ†åŒæœŸ*

### åŒæœŸæ–¹æ³•ã®æ¯”è¼ƒ

| è¦³ç‚¹ | Google Drive | rsync | Syncthing | Git |
|------|-------------|-------|-----------|-----|
| é™¤å¤–ãƒ•ã‚£ãƒ«ã‚¿ | ãªã— | `--exclude` | `.stignore` | `.gitignore` |
| åŒæ–¹å‘åŒæœŸ | ã‚ã‚Š | ç‰‡æ–¹å‘ | ã‚ã‚Š | merge/pull |
| node_moduleså¯¾å¿œ | ä¸å¯ï¼ˆæš´èµ°ã™ã‚‹ï¼‰ | é™¤å¤–å¯èƒ½ | é™¤å¤–å¯èƒ½ | .gitignore |
| ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ç°¡å˜ | ã‚³ãƒãƒ³ãƒ‰çŸ¥è­˜å¿…è¦ | ã‚„ã‚„æ‰‹é–“ | å¿…é ˆçŸ¥è­˜ |
| ç¶™ç¶šçš„åŒæœŸ | è‡ªå‹• | cronç­‰ã§è¨­å®š | è‡ªå‹• | æ‰‹å‹•push/pull |
| ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | ä¸è¦ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰çµŒç”±ï¼‰ | SSHå¿…è¦ | è‡ªå‹•æ¤œå‡º | ãƒªãƒ¢ãƒ¼ãƒˆå¿…è¦ |
| ã‚³ã‚¹ãƒˆ | æœ‰æ–™ï¼ˆå®¹é‡æ¬¡ç¬¬ï¼‰ | ç„¡æ–™ | ç„¡æ–™ | ç„¡æ–™ï¼ˆGitHubç­‰ï¼‰ |

## Google Driveã‚’ä½¿ã†ã¹ãã‚±ãƒ¼ã‚¹ / ä½¿ã†ã¹ãã§ãªã„ã‚±ãƒ¼ã‚¹

Google DriveãŒæ‚ªã„ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç”¨é€”ã‚’é–“é•ãˆãŸã®ãŒå•é¡Œã€‚

| ã‚±ãƒ¼ã‚¹ | æ¨å¥¨ | ç†ç”± |
|--------|------|------|
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ | Google Drive | Google Workspaceé€£æºãŒå¼·åŠ› |
| ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPSD, Figma exportç­‰ï¼‰ | Google Drive | ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå°‘ãªãã€ã‚µã‚¤ã‚ºãŒå¤§ãã„ |
| å†™çœŸãƒ»å‹•ç”»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– | Google Drive | å¤§å®¹é‡ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦å„ªç§€ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆzipåŒ–ï¼‰ | Google Drive | å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰å•é¡Œãªã— |
| é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ï¼ˆnode_moduleså«ã‚€ï¼‰ | Syncthing / rsync | å°ãƒ•ã‚¡ã‚¤ãƒ«å¤§é‡ = fileproviderdæš´èµ° |
| Gitãƒªãƒã‚¸ãƒˆãƒªï¼ˆ.gitå«ã‚€ï¼‰ | Git + GitHub | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¯Gitã®ä»•äº‹ |
| .envãƒ•ã‚¡ã‚¤ãƒ« | 1Password / Secret Manager | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸNG |

:::message
åˆ¤æ–­åŸºæº–ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã€Œãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå°‘ãªãã€ã‚µã‚¤ã‚ºãŒå¤§ãã„ã€ãªã‚‰Google Driveã€‚ã€Œãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå¤šãã€ã‚µã‚¤ã‚ºãŒå°ã•ã„ã€ãªã‚‰Syncthing/rsyncã€‚é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã¯å¾Œè€…ã®å…¸å‹ä¾‹ã€‚
:::

## fileproviderdãŒæš´èµ°ã—ãŸã¨ãã®å¿œæ€¥å‡¦ç½®

ã‚‚ã—åŒã˜çŠ¶æ³ã«é™¥ã£ã¦ã—ã¾ã£ãŸå ´åˆã®å¯¾å‡¦æ³•ã‚‚æ›¸ã„ã¦ãŠãã¾ã™ã€‚

### 1. fileproviderdã‚’å¼·åˆ¶çµ‚äº†

```bash
# fileproviderdã‚’å¼·åˆ¶çµ‚äº†ï¼ˆè‡ªå‹•çš„ã«å†èµ·å‹•ã•ã‚Œã‚‹ï¼‰
killall fileproviderd

# Permission deniedã®å ´åˆã¯sudoã‚’ä»˜ã‘ã‚‹
sudo killall fileproviderd
```

ãŸã ã—ã€ã“ã‚Œã¯ä¸€æ™‚çš„ãªå¯¾å‡¦ã«éãã¾ã›ã‚“ã€‚fileproviderdã¯ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ¼ãƒ¢ãƒ³ãªã®ã§ã€killã—ã¦ã‚‚è‡ªå‹•çš„ã«å†èµ·å‹•ã•ã‚Œã‚‹ã€‚æ ¹æœ¬å¯¾ç­–ã¯æ¬¡ã®ã€ŒåŒæœŸå¯¾è±¡ã®é™¤å¤–ã€ã§ã™ã€‚

### 2. åŒæœŸå¯¾è±¡ã‹ã‚‰é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’é™¤å¤–

Google Driveã®è¨­å®šã§ã€é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’åŒæœŸå¯¾è±¡ã‹ã‚‰é™¤å¤–ã™ã‚‹ã®ãŒæ ¹æœ¬å¯¾ç­–ã€‚

1. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®Google Driveã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. è¨­å®šï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰â†’ è¨­å®š
3. ã€Œãƒã‚¤ãƒ‘ã‚½ã‚³ãƒ³ã€ã‚¿ãƒ–ã§åŒæœŸãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
4. é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ï¼ˆ`~/dev/`ç­‰ï¼‰ã‚’åŒæœŸå¯¾è±¡ã‹ã‚‰é™¤å¤–

### 3. Spotlightã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é™¤å¤–

é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã¯Spotlightã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å¯¾è±¡ã‹ã‚‰ã‚‚é™¤å¤–ã—ã¦ãŠãã¨ã€ã•ã‚‰ã«ãƒ‡ã‚£ã‚¹ã‚¯I/Oã‚’å‰Šæ¸›ã§ãã¾ã™ã€‚

```
ã‚·ã‚¹ãƒ†ãƒ è¨­å®š â†’ Spotlight â†’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ â†’ ~/dev/ã‚’è¿½åŠ 
```

## ã¾ã¨ã‚

- Google Driveã§é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’åŒæœŸã—ã¦ã¯ã„ã‘ãªã„ã€‚node_modulesã€.gitã€vendorãªã©ã®å¤§é‡å°ãƒ•ã‚¡ã‚¤ãƒ«ãŒfileproviderdã‚’æš´èµ°ã•ã›ã‚‹
- 167GBã®æ›¸ãè¾¼ã¿ã¯ã€å®Ÿãƒ‡ãƒ¼ã‚¿10.3GiBã®ç´„15å€ã€‚SSDã®å¯¿å‘½ã‚’ç„¡é§„ã«æ¶ˆè²»ã™ã‚‹ä¸Šã€ãƒã‚·ãƒ³ãŒãƒ•ãƒªãƒ¼ã‚ºã™ã‚‹
- é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã®åŒæœŸã«ã¯Syncthingã¾ãŸã¯rsyncã‚’ä½¿ã†ã€‚é™¤å¤–ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½ãŒã‚ã‚Šã€é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã®ç‰¹æ€§ã«å¯¾å¿œã§ãã‚‹
- Google Driveã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ä½¿ã†ã€‚ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå°‘ãªãã‚µã‚¤ã‚ºãŒå¤§ãã„ãƒ‡ãƒ¼ã‚¿ã¨ã®ç›¸æ€§ãŒè‰¯ã„
- åˆ¤æ–­åŸºæº–ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«æ•° x ã‚µã‚¤ã‚ºã€ã€‚å¤§é‡ã®å°ãƒ•ã‚¡ã‚¤ãƒ« = ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸNGã€å°‘æ•°ã®å¤§ãƒ•ã‚¡ã‚¤ãƒ« = ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸOK

> é–‹ç™ºãƒ•ã‚©ãƒ«ãƒ€ã‚’Google Driveã«å…¥ã‚Œã‚‹ã®ã¯ã€æ®µãƒœãƒ¼ãƒ«1ä¸‡å€‹ã‚’ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã§é‹ã¶ã‚ˆã†ãªã‚‚ã®ã€‚è·ç‰©ã®ç·é‡é‡ã¯å¤§ã—ãŸã“ã¨ãªãã¦ã‚‚ã€ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã¯ç¢ºå®Ÿã«ãƒ‘ãƒ³ã‚¯ã™ã‚‹ã€‚

## å‚è€ƒè³‡æ–™

https://developer.apple.com/documentation/fileprovider

https://tidbits.com/2023/03/10/apples-file-provider-forces-mac-cloud-storage-changes/

https://osxdaily.com/2024/03/16/what-is-fileproviderd-on-mac-why-does-it-use-high-cpu/

https://support.google.com/drive/thread/255503539

https://medium.com/@bozzified/solving-painful-syncing-of-node-modules-when-using-dropbox-or-google-drive-a77c2ab0c97c

https://arshaw.com/exclude-node-modules-dropbox-google-drive

https://syncthing.net/
